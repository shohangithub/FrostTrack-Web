<section class="main-content">
  <div class="section-body">
    <div class="row">
      <form
        class="register-form"
        [formGroup]="billCollectionForm"
        (ngSubmit)="onSubmit()"
      >
        <div class="container mt-2">
          <div class="row">
            <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
              <div class="card mb-3">
                <span class="card-label">Bill Collection Information</span>
                <div class="card-body-narrow">
                  <div class="row">
                    <div class="col-lg-4 col-md-4 col-sm-4 col-xs-12">
                      <div class="form-group row">
                        <label
                          for="transactionCode"
                          class="col-sm-4 col-form-label"
                          >Transaction Code:</label
                        >
                        <div class="col-sm-8">
                          <input
                            type="text"
                            class="form-control form-control-sm"
                            id="transactionCode"
                            formControlName="transactionCode"
                            readonly
                          />
                        </div>
                      </div>
                    </div>
                    <div class="col-lg-4 col-md-4 col-sm-4 col-xs-12">
                      <div class="form-group row">
                        <label
                          for="transactionDate"
                          class="col-sm-4 col-form-label"
                          >Date:</label
                        >
                        <div class="col-sm-8">
                          <input
                            type="date"
                            class="form-control form-control-sm"
                            id="transactionDate"
                            formControlName="transactionDate"
                          />
                        </div>
                      </div>
                    </div>
                    <div class="col-lg-4 col-md-4 col-sm-4 col-xs-12">
                      <div class="form-group row">
                        <label for="bookingId" class="col-sm-4 col-form-label"
                          >Booking:</label
                        >
                        <div class="col-sm-8">
                          <ng-select
                            id="bookingId"
                            formControlName="bookingId"
                            [items]="bookings"
                            bindLabel="text"
                            bindValue="value"
                            [loading]="bookingLoading"
                            [clearable]="false"
                            placeholder="Select booking"
                            class="ng-select-sm"
                          >
                          </ng-select>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-lg-4 col-md-4 col-sm-4 col-xs-12">
                      <div class="form-group row">
                        <label class="col-sm-4 col-form-label">Customer:</label>
                        <div class="col-sm-8">
                          <input
                            type="text"
                            class="form-control form-control-sm"
                            [value]="selectedBooking?.customerName || ''"
                            readonly
                          />
                        </div>
                      </div>
                    </div>
                    <div class="col-lg-4 col-md-4 col-sm-4 col-xs-12">
                      <div class="form-group row">
                        <label class="col-sm-4 col-form-label"
                          >Booking Date:</label
                        >
                        <div class="col-sm-8">
                          <input
                            type="text"
                            class="form-control form-control-sm"
                            [value]="
                              (selectedBooking?.bookingDate
                                | date : 'dd/MM/yyyy') || ''
                            "
                            readonly
                          />
                        </div>
                      </div>
                    </div>
                    <div class="col-lg-4 col-md-4 col-sm-4 col-xs-12">
                      <div class="form-group row">
                        <label class="col-sm-4 col-form-label"
                          >D. Last Date:</label
                        >
                        <div class="col-sm-8">
                          <input
                            type="text"
                            class="form-control form-control-sm"
                            [value]="
                              (selectedBooking?.lastDeliveryDate
                                | date : 'dd/MM/yyyy') || ''
                            "
                            readonly
                          />
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Payment Information -->
          <div class="row">
            <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
              <div class="card mb-3">
                <span class="card-label">Payment Summary</span>
                <div class="card-body">
                  <div class="row">
                    <div class="col-lg-6 col-md-6 col-sm-6 col-xs-12">
                      <div class="form-group row">
                        <label class="col-sm-5 col-form-label"
                          >Total Charges:</label
                        >
                        <div class="col-sm-7">
                          <input
                            type="text"
                            class="form-control form-control-sm text-end"
                            [value]="
                              selectedBooking?.totalAmount | number : '1.2-2'
                            "
                            readonly
                          />
                        </div>
                      </div>
                    </div>
                    <div class="col-lg-6 col-md-6 col-sm-6 col-xs-12">
                      <div class="form-group row">
                        <label class="col-sm-5 col-form-label"
                          >Previous Payments:</label
                        >
                        <div class="col-sm-7">
                          <input
                            type="text"
                            class="form-control form-control-sm text-end"
                            [value]="
                              selectedBooking?.paidAmount | number : '1.2-2'
                            "
                            readonly
                          />
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-lg-6 col-md-6 col-sm-6 col-xs-12">
                      <div class="form-group row mb-2">
                        <label class="col-sm-5 col-form-label"
                          ><strong>Remaining Balance:</strong></label
                        >
                        <div class="col-sm-7">
                          <input
                            type="text"
                            class="form-control form-control-sm text-end fw-bold text-danger"
                            [value]="
                              selectedBooking?.dueAmount | number : '1.2-2'
                            "
                            readonly
                          />
                        </div>
                      </div>
                    </div>
                    <div class="col-lg-6 col-md-6 col-sm-6 col-xs-12">
                      <div class="form-group row mb-2">
                        <label for="amount" class="col-sm-5 col-form-label"
                          >Amount: <span class="text-danger">*</span></label
                        >
                        <div class="col-sm-7">
                          <input
                            type="number"
                            class="form-control form-control-sm text-end"
                            id="amount"
                            formControlName="amount"
                            (blur)="validateAmount()"
                            step="0.01"
                          />
                          @if (billCollectionForm.get('amount')?.invalid &&
                          billCollectionForm.get('amount')?.touched) {
                          <small class="text-danger"
                            >Amount is required and must be greater than
                            0</small
                          >
                          }
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-lg-6 col-md-6 col-sm-6 col-xs-12">
                      <div class="form-group row mb-2">
                        <label
                          for="paymentMethod"
                          class="col-sm-5 col-form-label"
                          >Payment Method:
                          <span class="text-danger">*</span></label
                        >
                        <div class="col-sm-7">
                          <ng-select
                            id="paymentMethod"
                            formControlName="paymentMethod"
                            [items]="paymentMethods"
                            bindLabel="label"
                            bindValue="value"
                            [clearable]="false"
                            class="ng-select-sm"
                          >
                          </ng-select>
                        </div>
                      </div>
                    </div>
                    <div class="col-lg-6 col-md-6 col-sm-6 col-xs-12">
                      <div class="form-group row mb-0">
                        <label for="note" class="col-sm-2 col-form-label"
                          >Notes:</label
                        >
                        <div class="col-sm-10">
                          <textarea
                            class="form-control form-control-sm"
                            id="note"
                            formControlName="note"
                            rows="2"
                            placeholder="Add notes..."
                          ></textarea>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="row">
                    <div
                      class="col-lg-12 col-md-12 col-sm-12 col-xs-12 text-end mt-2"
                    >
                      <button
                        type="submit"
                        class="btn btn-primary btn-sm me-2"
                        [disabled]="isSubmitting || !selectedBooking"
                      >
                        <i class="fas fa-save"></i>
                        {{ isSubmitting ? "Saving..." : "Save" }}
                      </button>
                      <button
                        type="button"
                        class="btn btn-success btn-sm me-2"
                        [disabled]="isSubmitting || !selectedBooking"
                        (click)="onSaveAndPrint()"
                      >
                        <i class="fas fa-print"></i>
                        Save & Print
                      </button>
                      <button
                        type="button"
                        class="btn btn-secondary btn-sm me-2"
                        (click)="reset()"
                        [disabled]="isSubmitting"
                      >
                        <i class="fas fa-redo"></i>
                        Reset
                      </button>
                      <a
                        routerLink="/bill-collection/list"
                        class="btn btn-danger btn-sm"
                      >
                        <i class="fas fa-times"></i>
                        Cancel
                      </a>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </form>
    </div>
  </div>
</section>
