<div class="modal-header">
  <h4 class="modal-title fw-bold font-17" id="modal-basic-title">
    {{ isEditing ? "Update" : "Add" }} Branch
  </h4>
  <button
    type="button"
    class="close"
    aria-label="Close"
    (click)="activeModal.close(false)"
  >
    <span aria-hidden="true"><i class="material-icons">close</i></span>
  </button>
</div>

<div class="modal-body">
  @if(isLoading){
  <app-form-shimmer [height]="150"></app-form-shimmer>
  } @else{
  <!-- Form for Add/Edit Branch -->
  <form class="register-form" [formGroup]="register" (ngSubmit)="onSubmit()">
    <div class="row">
      <div class="col-xl-6 col-lg-6 col-md-12 col-sm-12 mb-2">
        <label>Branch Name <span class="text-danger">*</span></label>
        <input
          type="text"
          class="form-control form-control-sm"
          placeholder="Branch Name"
          formControlName="name"
          required
        />
        @if (!register.get('name')?.valid && register.get('name')?.touched) {
        <small class="form-text text-danger"> Branch Name is required </small>
        }
      </div>
      <div class="col-xl-6 col-lg-6 col-md-12 col-sm-12 mb-2">
        <label>Branch Code<span class="text-danger">*</span></label>
        <div class="form-group">
          <div class="input-group mb-3">
            <input
              type="text"
              class="form-control form-control-sm"
              placeholder="Branch Code"
              formControlName="branchCode"
              readonly
              required
            />
            <div
              class="input-group-append"
              style="cursor: pointer"
              (click)="generateCode()"
            >
              <span
                class="input-group-text input-group-text-append"
                style=""
                id="basic-addon5"
              >
                <i
                  class="fas"
                  [ngClass]="
                    isGeneratingCode ? 'fa-spinner fa-spin' : 'fa-sync'
                  "
                ></i>
              </span>
            </div>
          </div>
        </div>
        @if (!register.get('branchCode')?.valid &&
        register.get('branchCode')?.touched) {
        <small class="form-text text-danger"> Branch Code is required </small>
        }
      </div>
    </div>
    <div class="row">
      <div class="col-xl-6 col-lg-6 col-md-12 col-sm-12 mb-2">
        <label>Phone<span class="text-danger">*</span></label>
        <input
          type="text"
          class="form-control form-control-sm"
          placeholder="Phone Number"
          formControlName="phone"
          required
        />
        @if (!register.get('phone')?.valid && register.get('phone')?.touched) {
        <small class="form-text text-danger"> Phone is required </small>
        }
      </div>
      <div class="col-xl-6 col-lg-6 col-md-12 col-sm-12 mb-2">
        <label>Address<span class="text-danger">*</span></label>
        <input
          type="text"
          class="form-control form-control-sm"
          placeholder="Branch Address"
          formControlName="address"
          required
        />
        @if (!register.get('address')?.valid &&
        register.get('address')?.touched) {
        <small class="form-text text-danger"> Address is required </small>
        }
      </div>
    </div>
    <div class="row">
      <div class="col-xl-6 col-lg-6 col-md-12 col-sm-12 mb-2">
        <label>Business Currency</label>
        <select
          class="form-control form-control-sm"
          formControlName="businessCurrency"
          (change)="onCurrencyChange($event)"
        >
          <option *ngFor="let currency of currencyList" [value]="currency.id">
            {{ currency.value }}
          </option>
        </select>
      </div>
      <div class="col-xl-6 col-lg-6 col-md-12 col-sm-12 mb-2">
        <label>Currency Symbol</label>
        <input
          type="text"
          class="form-control form-control-sm"
          placeholder="e.g. $, ৳, €"
          formControlName="currencySymbol"
        />
      </div>
    </div>
    <div class="row">
      <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 mb-2">
        <label>Invoice Header</label>
        <textarea
          class="form-control form-control-sm"
          placeholder="Invoice Header Text"
          formControlName="invoiceHeader"
          rows="2"
        ></textarea>
      </div>
    </div>
    <div class="row">
      <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 mb-2">
        <label>Invoice Footer</label>
        <textarea
          class="form-control form-control-sm"
          placeholder="Invoice Footer Text"
          formControlName="invoiceFooter"
          rows="2"
        ></textarea>
      </div>
    </div>
    <div class="row">
      <div class="col-xl-4 col-lg-4 col-md-12 col-sm-12 mb-2">
        <div class="form-check">
          <input
            class="form-check-input"
            type="checkbox"
            formControlName="autoInvoicePrint"
            id="autoInvoicePrint"
          />
          <label class="form-check-label" for="autoInvoicePrint">
            Auto Invoice Print
          </label>
        </div>
      </div>
      <div class="col-xl-4 col-lg-4 col-md-12 col-sm-12 mb-2">
        <div class="form-check">
          <input
            class="form-check-input"
            type="checkbox"
            formControlName="isMainBranch"
            id="isMainBranch"
          />
          <label class="form-check-label" for="isMainBranch">
            Main Branch
          </label>
        </div>
      </div>
      <div class="col-xl-4 col-lg-4 col-md-12 col-sm-12 mb-2">
        <div class="form-check">
          <input
            class="form-check-input"
            type="checkbox"
            formControlName="isActive"
            id="isActive"
          />
          <label class="form-check-label" for="isActive"> Active </label>
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button
        type="button"
        class="btn btn-outline-secondary btn-sm"
        (click)="closeModal()"
      >
        Close
      </button>
      <button
        type="submit"
        class="btn btn-primary btn-sm"
        [disabled]="register.invalid"
      >
        {{ isEditing ? "Update" : "Add" }} Branch
      </button>
    </div>
  </form>
  }
</div>
